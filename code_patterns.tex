
\documentclass{article}
\usepackage{geometry}
\geometry{a4paper, margin=0.6in}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{booktabs}

\lstset{
  basicstyle=\ttfamily\footnotesize,
  breaklines=true,
  frame=single,
  backgroundcolor=\color{gray!10},
  xleftmargin=0.5cm,
  xrightmargin=0.5cm
}

\begin{document}
\title{Common Code Patterns (Alpha-Equivalence)}
\author{Antigravity Agent}
\date{\today}
\maketitle

\section{Overview}
This report shows actual code patterns that appear multiple times in \texttt{spip.cpp}, detected using alpha-equivalence (variable name normalization).

\section{Common Patterns}


\subsection*{Pattern 1: Function-Call (57 occurrences)}

\textbf{Pattern ID:} \texttt{call:6c66ec86}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
create_directories(scripts_dir);
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR(VAR);
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 56 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 2: Assignment (14 occurrences)}

\textbf{Pattern ID:} \texttt{assign:3816d22f}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
extraction_helper = cfg.spip_root / "scripts" / "safe_extract.py"
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR.VAR / "STR" / "STR"
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 13 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 3: Assignment (12 occurrences)}

\textbf{Pattern ID:} \texttt{assign:53cd0d06}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
out = get_exec_output(cmd)
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR(VAR)
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 11 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 4: Assignment (12 occurrences)}

\textbf{Pattern ID:} \texttt{assign:0a6c11e2}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
pkg = q.front()
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR.VAR()
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 11 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 5: Assignment (11 occurrences)}

\textbf{Pattern ID:} \texttt{assign:460ef88e}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
RESET = "\033[0m"
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = "STR"
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 10 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 6: Function-Call (10 occurrences)}

\textbf{Pattern ID:} \texttt{call:58c6c839}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
create_base_version(cfg, version);
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR(VAR, VAR);
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 9 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 7: Assignment (9 occurrences)}

\textbf{Pattern ID:} \texttt{assign:f8ced854}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
spip_root = cfg.home_dir / ".spip"
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR.VAR / "STR"
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 8 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 8: Assignment (8 occurrences)}

\textbf{Pattern ID:} \texttt{assign:918b7b68}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
command = = "prune") {
        setup_project_env(cfg)
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = = "STR") { VAR(VAR)
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 7 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 9: If-Statement (7 occurrences)}

\textbf{Pattern ID:} \texttt{if:a6ff1bda}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
if (command == "bundle") { if (args.size() < 2) {
            std::cout << "Usage: spip bundle <folder>" << }
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR == "STR" -> VAR (VAR.VAR() < NUM) { VAR::VAR << "STR" << VAR::VAR; VAR;
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 6 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 10: Assignment (7 occurrences)}

\textbf{Pattern ID:} \texttt{assign:a561ba01}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
name = entry.path().filename().string()
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR.VAR().VAR().VAR()
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 6 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 11: Function-Call (6 occurrences)}

\textbf{Pattern ID:} \texttt{call:a2b04579}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
for (size_t i = 0; i < cpp_files.size();
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR (VAR VAR = NUM; VAR < VAR.VAR();
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 5 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 12: Assignment (6 occurrences)}

\textbf{Pattern ID:} \texttt{assign:6a27acac}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
ret = std::system(venv_cmd.c_str())
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR = VAR::VAR(VAR.VAR())
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 5 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 13: Function-Call (5 occurrences)}

\textbf{Pattern ID:} \texttt{call:4ef80dae}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
format("{:x}", h);
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR("STR", VAR);
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 4 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 14: Function-Call (5 occurrences)}

\textbf{Pattern ID:} \texttt{call:52c6a25d}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
bundle_package(cfg, args[1]);
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR(VAR, VAR[NUM]);
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 4 more instance(s) with the same structure

\vspace{0.3cm}


\subsection*{Pattern 15: If-Statement (4 occurrences)}

\textbf{Pattern ID:} \texttt{if:c4d85ad6}

\textbf{Example Instance:}

\begin{lstlisting}[language=C++]
if (command == "prune") { setup_project_env(cfg);
        prune_orphans(cfg); }
\end{lstlisting}

\textbf{Normalized Form (Alpha-Equivalent):}

\begin{lstlisting}
VAR == "STR" -> VAR(VAR); VAR(VAR);
\end{lstlisting}

\noindent\textbf{Other Occurrences:} 3 more instance(s) with the same structure

\vspace{0.3cm}


\section{Interpretation}

These patterns represent opportunities for:
\begin{itemize}
    \item \textbf{Common Subexpression Elimination (CSE)}: Extract repeated logic into helper functions
    \item \textbf{Code Refactoring}: Reduce duplication and improve maintainability
    \item \textbf{Template/Macro Creation}: For frequently used patterns
\end{itemize}

The normalization process converts variable names to placeholders, allowing detection of structurally equivalent code even when identifiers differ.

\end{document}
